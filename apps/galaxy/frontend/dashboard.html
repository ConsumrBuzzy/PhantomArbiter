<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>THE VOID | Phantom Arbiter</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Courier New', Courier, monospace;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }

        #overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #0f0;
            pointer-events: none;
            z-index: 10;
            width: 300px;
        }

        .hud-text {
            font-size: 14px;
            text-shadow: 0 0 5px #0f0;
            margin-bottom: 5px;
        }

        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 280px;
            background: rgba(0, 20, 0, 0.7);
            border: 1px solid #0f0;
            padding: 15px;
            color: #0f0;
            font-family: 'Courier New', monospace;
            z-index: 100;
            pointer-events: none;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.2);
            backdrop-filter: blur(5px);
        }

        .legend-title {
            font-weight: bold;
            border-bottom: 1px solid #0f0;
            padding-bottom: 5px;
            margin-bottom: 10px;
            text-align: center;
            letter-spacing: 2px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 5px currentColor;
        }

        .line {
            width: 25px;
            height: 2px;
            margin-right: 10px;
            background: currentColor;
            box-shadow: 0 0 5px currentColor;
        }

        /* Scrollbar styling for components */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 10, 0, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: #0f0;
        }
    </style>
    <link rel="stylesheet" href="hud.css">
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <!-- 3D Canvas -->
    <div id="canvas-container"></div>

    <!-- HUD Overlay -->
    <div id="hud-layer">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="hud-text">PHANTOM ARBITER</div>
            <div class="panel-title">// COMMAND DECK</div>

            <div class="hud-panel">
                <div class="panel-title">Active Targets</div>
                <div id="target-list">
                    <!-- Dynamic Rows -->
                </div>
            </div>

            <div class="hud-panel">
                <div class="panel-title">System Integrity</div>
                <div class="progress-container">
                    <div class="progress-fill" style="width: 100%;"></div>
                </div>
                <div style="font-size: 10px; margin-top: 5px;">FLASH_CACHE: ONLINE</div>
            </div>

            <!-- Legacy Logs Slot -->
            <div id="log-stream" style="flex-grow: 1; overflow-y: auto;"></div>
        </div>

        <!-- MiniMap -->
        <div id="minimap-container"></div>

        <!-- Status Bar -->
        <div id="status-bar">
            <div class="status-item">FPS: <span id="fps-counter" class="status-value">60</span></div>
            <div class="status-item">EVENTS: <span id="event-counter" class="status-value">0</span>/s</div>
            <div class="status-item">SHIPS: <span id="ship-counter" class="status-value">0</span></div>
            <div class="status-item" style="margin-left: auto;">NET: <span class="status-value">STABLE</span></div>
        </div>
    </div>

    <!-- Legacy Overlay (Hidden or Repurposed) -->
    <div id="overlay" style="display:none;"></div>
    <div id="legend" style="display:none;"></div>

    <script type="module">
        import { GalaxyGame } from './managers/GalaxyGame.js';
        import { StatsPanel } from './components/StatsPanel.js';
        import { LogStream } from './components/LogStream.js';
        import { ScanTable } from './components/ScanTable.js';

        // WS Configuration
        const API_HOST = window.location.hostname === "" ? "localhost:8001" : window.location.host;
        const WS_PROTOCOL = window.location.protocol === "https:" ? "wss:" : "ws:";
        const HTTP_PROTOCOL = window.location.protocol === "https:" ? "https:" : "http:";
        const WS_URL = `${WS_PROTOCOL}//${API_HOST}/ws/v1/stream`;
        const API_URL = `${HTTP_PROTOCOL}//${API_HOST}/api/v1/galaxy`;

        // Initialize Game Engine
        const game = new GalaxyGame('canvas-container', API_URL, WS_URL);

        // UI Components (Legacy Overlay)
        const stats = new StatsPanel('stats-panel');
        const logs = new LogStream('log-stream');
        const scanTable = new ScanTable('scan-table');


        // Legacy Component Hooks (Temporary Bridge)
        // We can expose the game instance to these if needed or refactor them later
        window.galaxyGame = game;

    </script>
    </script>
</body>

</html>